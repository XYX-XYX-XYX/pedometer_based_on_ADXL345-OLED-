C51 COMPILER V9.60.7.0   ADXL345                                                           07/16/2023 15:16:11 PAGE 1   


C51 COMPILER V9.60.7.0, COMPILATION OF MODULE ADXL345
OBJECT MODULE PLACED IN .\Objects\adxl345.obj
COMPILER INVOKED BY: D:\app\keil\C51\BIN\C51.EXE adxl345.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(.\Listings\
                    -adxl345.lst) TABS(2) OBJECT(.\Objects\adxl345.obj)

line level    source

   1          #include"adxl345.h"
*** WARNING C206 IN LINE 231 OF adxl345.h: 'Multiple_Read_ADXL345': missing function-prototype
   2          #include  <REG52.H>
   3          #include "intrins.h"
   4          #include  <math.h>    //Keil library  
   5          #include  <stdio.h>   //Keil library  
   6          /**************************************
   7            å»¶æ—¶5å¾®ç§’(STC90C52RC@12M)
   8            ä¸åŒçš„å·¥ä½œç¯å¢ƒ,éœ€è¦è°ƒæ•´æ­¤å‡½æ•°ï¼Œæ³¨æ„æ—¶é’Ÿè¿‡å¿«æ—¶éœ€è¦ä¿®æ”¹
   9            å½“æ”¹ç”¨1Tçš„MCUæ—¶,è¯·è°ƒæ•´æ­¤å»¶æ—¶å‡½æ•°
  10          **************************************/
  11          
  12          void Delay5us()
  13          {
  14   1        _nop_(); _nop_(); _nop_(); _nop_();
  15   1        _nop_(); _nop_(); _nop_(); _nop_();
  16   1        _nop_(); _nop_(); _nop_(); _nop_();
  17   1      }
*** ERROR C237 IN LINE 17 OF adxl345.c: 'Delay5us': function already has a body
  18          
  19          /**************************************
  20            å»¶æ—¶5æ¯«ç§’(STC90C52RC@12M)
  21            ä¸åŒçš„å·¥ä½œç¯å¢ƒ,éœ€è¦è°ƒæ•´æ­¤å‡½æ•°
  22            å½“æ”¹ç”¨1Tçš„MCUæ—¶,è¯·è°ƒæ•´æ­¤å»¶æ—¶å‡½æ•°
  23          **************************************/
  24          void Delay5ms()
  25          {
  26   1        WORD n = 560;
  27   1      
  28   1        while (n--);
  29   1      }
*** ERROR C237 IN LINE 29 OF adxl345.c: 'Delay5ms': function already has a body
  30          /*******************************/
  31          void delay(unsigned int k)      //????ms
  32          {
  33   1        unsigned int i, j;
  34   1        for (i = 0; i < k; i++)
  35   1        {
  36   2          for (j = 0; j < 121; j++)
  37   2          {
  38   3            ;
  39   3          }
  40   2        }
  41   1      }
*** ERROR C237 IN LINE 41 OF adxl345.c: '_delay': function already has a body
  42          /**************************************
  43            èµ·å§‹ä¿¡å·
  44          **************************************/
  45          void ADXL345_Start()
  46          {
  47   1        SDA = 1;                    //æ‹‰é«˜æ•°æ®çº¿
  48   1        SCL = 1;                    //æ‹‰é«˜æ—¶é’Ÿçº¿
  49   1        Delay5us();                 //å»¶æ—¶
  50   1        SDA = 0;                    //äº§ç”Ÿä¸‹é™æ²¿
C51 COMPILER V9.60.7.0   ADXL345                                                           07/16/2023 15:16:11 PAGE 2   

  51   1        Delay5us();                 //å»¶æ—¶
  52   1        SCL = 0;                    //æ‹‰ä½æ—¶é’Ÿçº¿
  53   1      }
*** ERROR C237 IN LINE 53 OF adxl345.c: 'ADXL345_Start': function already has a body
  54          
  55          /**************************************
  56            åœæ­¢ä¿¡å·
  57          **************************************/
  58          void ADXL345_Stop()
  59          {
  60   1        SDA = 0;                    //æ‹‰ä½æ•°æ®çº¿
  61   1        SCL = 1;                    //æ‹‰é«˜æ—¶é’Ÿçº¿
  62   1        Delay5us();                 //å»¶æ—¶
  63   1        SDA = 1;                    //äº§ç”Ÿä¸Šå‡æ²¿
  64   1        Delay5us();                 //å»¶æ—¶
  65   1      }
*** ERROR C237 IN LINE 65 OF adxl345.c: 'ADXL345_Stop': function already has a body
  66          /**************************************
  67            å‘é€åº”ç­”ä¿¡å·
  68            å…¥å£å‚æ•°:ack (0:ACK 1:NAK)
  69          **************************************/
  70          void ADXL345_SendACK(bit ack)
  71          {
  72   1        SDA = ack;                  //å†™åº”ç­”ä¿¡å·
  73   1        SCL = 1;                    //æ‹‰é«˜æ—¶é’Ÿçº¿
  74   1        Delay5us();                 //å»¶æ—¶
  75   1        SCL = 0;                    //æ‹‰ä½æ—¶é’Ÿçº¿
  76   1        Delay5us();                 //å»¶æ—¶
  77   1      }
*** ERROR C237 IN LINE 77 OF adxl345.c: 'ADXL345_SendACK': function already has a body
  78          
  79          /**************************************
  80            æ¥æ”¶åº”ç­”ä¿¡å·
  81          **************************************/
  82          bit ADXL345_RecvACK()
  83          {
  84   1        SCL = 1;                    //æ‹‰é«˜æ—¶é’Ÿçº¿
  85   1        Delay5us();                 //å»¶æ—¶
  86   1        CY = SDA;                   //è¯»åº”ç­”ä¿¡å·
  87   1        SCL = 0;                    //æ‹‰ä½æ—¶é’Ÿçº¿
  88   1        Delay5us();                 //å»¶æ—¶
  89   1      
  90   1        return CY;
  91   1      }
*** ERROR C237 IN LINE 91 OF adxl345.c: 'ADXL345_RecvACK': function already has a body
  92          
  93          /**************************************
  94            å‘IICæ€»çº¿å‘é€ä¸€ä¸ªå­—èŠ‚æ•°æ®
  95          **************************************/
  96          void ADXL345_SendByte(BYTE dat)
  97          {
  98   1        BYTE i;
  99   1      
 100   1        for (i = 0; i < 8; i++)     //8ä½è®¡æ•°å™¨
 101   1        {
 102   2          dat <<= 1;              //ç§»å‡ºæ•°æ®çš„æœ€é«˜ä½
 103   2          SDA = CY;               //é€æ•°æ®å£
 104   2          SCL = 1;                //æ‹‰é«˜æ—¶é’Ÿçº¿
 105   2          Delay5us();             //å»¶æ—¶
 106   2          SCL = 0;                //æ‹‰ä½æ—¶é’Ÿçº¿
 107   2          Delay5us();             //å»¶æ—¶
 108   2        }
C51 COMPILER V9.60.7.0   ADXL345                                                           07/16/2023 15:16:11 PAGE 3   

 109   1        ADXL345_RecvACK();
 110   1      }
*** ERROR C237 IN LINE 110 OF adxl345.c: '_ADXL345_SendByte': function already has a body
 111          
 112          /**************************************
 113            ä»IICæ€»çº¿æ¥æ”¶ä¸€ä¸ªå­—èŠ‚æ•°æ®
 114          **************************************/
 115          BYTE ADXL345_RecvByte()
 116          {
 117   1        BYTE i;
 118   1        BYTE dat = 0;
 119   1      
 120   1        SDA = 1;                    //ä½¿èƒ½å†…éƒ¨ä¸Šæ‹‰,å‡†å¤‡è¯»å–æ•°æ®,
 121   1        for (i = 0; i < 8; i++)     //8ä½è®¡æ•°å™¨
 122   1        {
 123   2          dat <<= 1;
 124   2          SCL = 1;                //æ‹‰é«˜æ—¶é’Ÿçº¿
 125   2          Delay5us();             //å»¶æ—¶
 126   2          dat |= SDA;             //è¯»æ•°æ®
 127   2          SCL = 0;                //æ‹‰ä½æ—¶é’Ÿçº¿
 128   2          Delay5us();             //å»¶æ—¶
 129   2        }
 130   1        return dat;
 131   1      }
*** ERROR C237 IN LINE 131 OF adxl345.c: 'ADXL345_RecvByte': function already has a body
 132          
 133          //******å•å­—èŠ‚å†™å…¥*******************************************
 134          
 135          void Single_Write_ADXL345(uint8 REG_Address, uint8 REG_data)
 136          {
 137   1        ADXL345_Start();                  //èµ·å§‹ä¿¡å·
 138   1        ADXL345_SendByte(SlaveAddress);   //å‘é€è®¾å¤‡åœ°å€+å†™ä¿¡å·
 139   1        ADXL345_SendByte(REG_Address);    //å†…éƒ¨å¯„å­˜å™¨åœ°å€ï¼Œè¯·å‚è€ƒä¸­æ–‡pdf22é¡µ
 140   1        ADXL345_SendByte(REG_data);       //å†…éƒ¨å¯„å­˜å™¨æ•°æ®ï¼Œè¯·å‚è€ƒä¸­æ–‡pdf22é¡µ
 141   1        ADXL345_Stop();                   //å‘é€åœæ­¢ä¿¡å·
 142   1      }
*** ERROR C237 IN LINE 142 OF adxl345.c: '_Single_Write_ADXL345': function already has a body
 143          
 144          //********å•å­—èŠ‚è¯»å–*****************************************
 145          uint8 Single_Read_ADXL345(uint8 REG_Address)
 146          { uint8 REG_data;
 147   1        ADXL345_Start();                          //èµ·å§‹ä¿¡å·
 148   1        ADXL345_SendByte(SlaveAddress);           //å‘é€è®¾å¤‡åœ°å€+å†™ä¿¡å·
 149   1        ADXL345_SendByte(REG_Address);            //å‘é€å­˜å‚¨å•å…ƒåœ°å€ï¼Œä»0å¼€å§‹
 150   1        ADXL345_Start();                          //èµ·å§‹ä¿¡å·
 151   1        ADXL345_SendByte(SlaveAddress + 1);       //å‘é€è®¾å¤‡åœ°å€+è¯»ä¿¡å·
 152   1        REG_data = ADXL345_RecvByte();            //è¯»å‡ºå¯„å­˜å™¨æ•°æ®
 153   1        ADXL345_SendACK(1);
 154   1        ADXL345_Stop();                           //åœæ­¢ä¿¡å·
 155   1        return REG_data;
 156   1      }
*** ERROR C237 IN LINE 156 OF adxl345.c: '_Single_Read_ADXL345': function already has a body
 157          //*********************************************************
 158          //
 159          //è¿ç»­è¯»å‡ºADXL345å†…éƒ¨åŠ é€Ÿåº¦æ•°æ®ï¼Œåœ°å€èŒƒå›´0x32~0x37
 160          //
 161          //*********************************************************
 162          void Multiple_read_ADXL345(void)
 163          { uint8 i;
 164   1        ADXL345_Start();                          //èµ·å§‹ä¿¡å·
 165   1        ADXL345_SendByte(SlaveAddress);           //å‘é€è®¾å¤‡åœ°å€+å†™ä¿¡å·
 166   1        ADXL345_SendByte(0x32);                   //å‘é€å­˜å‚¨å•å…ƒåœ°å€ï¼Œä»0x32å¼€å§‹
C51 COMPILER V9.60.7.0   ADXL345                                                           07/16/2023 15:16:11 PAGE 4   

 167   1        ADXL345_Start();                          //èµ·å§‹ä¿¡å·
 168   1        ADXL345_SendByte(SlaveAddress + 1);       //å‘é€è®¾å¤‡åœ°å€+è¯»ä¿¡å·
 169   1        for (i = 0; i < 6; i++)                  //è¿ç»­è¯»å–6ä¸ªåœ°å€æ•°æ®ï¼Œå­˜å‚¨ä¸­BUF
 170   1        {
 171   2          BUF[i] = ADXL345_RecvByte();          //BUF[0]å­˜å‚¨0x32åœ°å€ä¸­çš„æ•°æ®
 172   2          if (i == 5)
 173   2          {
 174   3            ADXL345_SendACK(1);                //æœ€åä¸€ä¸ªæ•°æ®éœ€è¦å›NOACK
 175   3          }
 176   2          else
 177   2          {
 178   3            ADXL345_SendACK(0);                //å›åº”ACK
 179   3          }
 180   2        }
 181   1        ADXL345_Stop();                          //åœæ­¢ä¿¡å·
 182   1        Delay5ms();
 183   1      }
*** ERROR C237 IN LINE 183 OF adxl345.c: 'Multiple_read_ADXL345': function already has a body
 184          
 185          
 186          //*****************************************************************
 187          
 188          //åˆå§‹åŒ–ADXL345ï¼Œæ ¹æ®éœ€è¦è¯·å‚è€ƒpdfè¿›è¡Œä¿®æ”¹************************
 189          void Init_ADXL345()
 190          {
 191   1        Single_Write_ADXL345(0x31, 0x0B);  //æµ‹é‡èŒƒå›´,æ­£è´Ÿ16gï¼Œ13ä½æ¨¡å¼
 192   1        Single_Write_ADXL345(0x2C, 0x08);  //é€Ÿç‡è®¾å®šä¸º12.5 å‚è€ƒpdf13é¡µ
 193   1        Single_Write_ADXL345(0x2D, 0x08);  //é€‰æ‹©ç”µæºæ¨¡å¼   å‚è€ƒpdf24é¡µ
 194   1        Single_Write_ADXL345(0x2E, 0x80);  //ä½¿èƒ½ DATA_READY ä¸­æ–­
 195   1        Single_Write_ADXL345(0x1E, 0x00);  //X åç§»é‡ æ ¹æ®æµ‹è¯•ä¼ æ„Ÿå™¨çš„çŠ¶æ€å†™å…¥pdf29é¡µ
 196   1        Single_Write_ADXL345(0x1F, 0x00);  //Y åç§»é‡ æ ¹æ®æµ‹è¯•ä¼ æ„Ÿå™¨çš„çŠ¶æ€å†™å…¥pdf29é¡µ
 197   1        Single_Write_ADXL345(0x20, 0x05);  //Z åç§»é‡ æ ¹æ®æµ‹è¯•ä¼ æ„Ÿå™¨çš„çŠ¶æ€å†™å…¥pdf29é¡µ
 198   1      }
*** ERROR C237 IN LINE 198 OF adxl345.c: 'Init_ADXL345': function already has a body
 199          //æ•´åˆxyzè½´çš„æ•°æ®,æ­£æ•´æ•°ï¼Œè¿”å› x*x+y*y+z*z  çš„è®¡ç®—å€¼
 200          float ADXL345_xyz()
 201          {
 202   1        float temp;
 203   1        float all = 0.0;
 204   1        dis_data = (BUF[1] << 8) + BUF[0]; //åˆæˆæ•°æ®
 205   1        if (dis_data < 0)  dis_data = -dis_data;
 206   1        temp = (float)dis_data / 10;
 207   1        all += temp * temp;
 208   1      
 209   1        dis_data = (BUF[3] << 8) + BUF[2]; //åˆæˆæ•°æ®
 210   1        if (dis_data < 0)  dis_data = -dis_data;
 211   1        temp = (float)dis_data / 10;
 212   1        all += temp * temp;
 213   1      
 214   1        dis_data = (BUF[5] << 8) + BUF[4]; //åˆæˆæ•°æ®
 215   1        if (dis_data < 0)  dis_data = -dis_data;
 216   1        temp = (float)dis_data / 10;
 217   1        all += temp * temp;
 218   1        return all;
 219   1      }
*** ERROR C237 IN LINE 219 OF adxl345.c: 'ADXL345_xyz': function already has a body
 220          
 221          //è·å–2æ¬¡æ•°æ®ä½œä¸ºå½“å‰çš„è·å¾—æ•°æ®ï¼Œå¤šæ¬¡æ•°æ®å–å¹³å‡å€¼ä½œä¸ºåˆ¤æ–­æ­¥æ•°çš„é˜ˆå€¼ï¼Œä¸å
             -½“å‰è·å¾—æ•°æ®æ¯”è¾ƒ ï¼Œä¿å­˜æ€»æ­¥æ•°åˆ°eeprom
 222          void calculate_xyz()
 223          {
 224   1        float temp;
C51 COMPILER V9.60.7.0   ADXL345                                                           07/16/2023 15:16:11 PAGE 5   

 225   1        temp = ADXL345_xyz();
 226   1        delay(20);
 227   1        Multiple_Read_ADXL345();
 228   1        temp = (temp + ADXL345_xyz()) / 2; //ä¸¤æ¬¡å€¼å–å¹³å‡
 229   1      
 230   1      
 231   1        average_all_temp += (uint16)(temp / average_all_times);
 232   1        average_all_num++;
 233   1        if (average_all_num >= average_all_times) {        //è¾¾åˆ°average_all_timesæ¬¡æ•°  æ•°æ®çš„å¹³å±€ä½œä¸
             -ºé˜ˆå€¼åˆ¤æ–­
 234   2          average_all_num = 0;
 235   2          average_all = average_all_temp;
 236   2          average_all_temp = 0;
 237   2        }
 238   1      
 239   1        if (temp > average_all + 55) {        //å½“æµ‹é‡å€¼ æ¯”é˜ˆå€¼+55å¤§ï¼Œè¯´æ˜èµ°äº†ä¸€æ­¥
 240   2          step_all++;
 241   2          delay(150);                //å»¶æ—¶ï¼Œé¿å…ä¸€æ­¥å½“åšå¤šæ­¥
 242   2        }
 243   1      }
*** ERROR C237 IN LINE 243 OF adxl345.c: 'calculate_xyz': function already has a body

C51 COMPILATION COMPLETE.  1 WARNING(S),  15 ERROR(S)
